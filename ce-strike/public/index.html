<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <title>CE Strike</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    :root{--cyan:#00e5ff;--orange:#ff6b35;--green:#b5ff4d;--purple:#e040fb;--yellow:#ffeb3b;--dark:#08080f;--darker:#050508;}
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    body{background:var(--dark);color:#e0e0e0;font-family:'Press Start 2P',monospace;overflow:hidden;user-select:none;touch-action:none;}
    body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.07) 2px,rgba(0,0,0,0.07) 4px);pointer-events:none;z-index:9999;}

    /* ‚îÄ‚îÄ LOBBY ‚îÄ‚îÄ */
    #lobby{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;background:var(--darker);z-index:100;overflow-y:auto;padding:20px 10px 30px;}
    #lobby-bg{position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.04) 1px,transparent 1px);background-size:40px 40px;animation:bgScroll 8s linear infinite;pointer-events:none;}
    @keyframes bgScroll{from{background-position:0 0}to{background-position:40px 40px}}
    #lobby-content{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;width:100%;max-width:700px;}
    .title-wrap{text-align:center;margin-bottom:24px;margin-top:10px;}
    #lobby h1{font-size:clamp(24px,6vw,52px);color:var(--cyan);text-shadow:0 0 30px var(--cyan),0 0 60px rgba(0,229,255,0.4);letter-spacing:clamp(3px,2vw,8px);animation:titlePulse 2s ease-in-out infinite;}
    @keyframes titlePulse{0%,100%{text-shadow:0 0 30px var(--cyan),0 0 60px rgba(0,229,255,0.4)}50%{text-shadow:0 0 50px var(--cyan),0 0 100px rgba(0,229,255,0.6)}}
    .subtitle{font-size:clamp(5px,1.5vw,8px);color:var(--orange);letter-spacing:2px;margin-top:8px;}
    #lobby input{background:rgba(0,229,255,0.05);border:2px solid var(--cyan);color:#fff;font-family:'Press Start 2P',monospace;font-size:clamp(9px,2.5vw,12px);padding:12px 20px;margin-bottom:20px;outline:none;width:min(360px,90vw);text-align:center;transition:all .2s;}
    #lobby input:focus{border-color:var(--orange);background:rgba(255,107,53,0.08);}
    .char-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:10px;margin-bottom:22px;width:100%;}
    .char-card{cursor:pointer;border:2px solid #1e1e2e;padding:12px 8px;text-align:center;transition:all .15s;background:rgba(255,255,255,0.02);position:relative;overflow:hidden;}
    .char-card:active{transform:scale(0.96);}
    .char-card.selected{border-color:var(--cyan);background:rgba(0,229,255,0.06);box-shadow:0 0 16px rgba(0,229,255,0.2);}
    .char-preview{display:block;margin:0 auto 8px;image-rendering:pixelated;}
    .char-name{font-size:clamp(5px,1.5vw,7px);color:#fff;margin-bottom:5px;}
    .char-weapon{font-size:clamp(4px,1.2vw,6px);color:#888;margin-bottom:8px;}
    .stat-row{display:flex;align-items:center;gap:4px;margin-bottom:3px;}
    .stat-label{font-size:clamp(4px,1vw,5px);color:#666;width:20px;text-align:right;}
    .stat-bar{flex:1;height:4px;background:#111;overflow:hidden;}
    .stat-fill{height:100%;}
    #btn-play{background:var(--cyan);color:#000;border:none;font-family:'Press Start 2P',monospace;font-size:clamp(10px,2.5vw,13px);padding:14px 40px;cursor:pointer;letter-spacing:2px;transition:all .15s;touch-action:manipulation;}
    #btn-play:active{background:var(--orange);transform:scale(0.97);}
    #btn-play:disabled{background:#1a1a2e;color:#333;cursor:not-allowed;}

    /* ‚îÄ‚îÄ SOUND TOGGLE ‚îÄ‚îÄ */
    #sound-toggle{position:fixed;top:12px;right:12px;background:rgba(0,0,0,0.75);border:2px solid #333;color:#aaa;font-family:'Press Start 2P',monospace;font-size:clamp(6px,1.5vw,8px);padding:8px 10px;cursor:pointer;z-index:200;touch-action:manipulation;}

    /* ‚îÄ‚îÄ GAME ‚îÄ‚îÄ */
    #gameCanvas{display:none;position:fixed;top:0;left:0;cursor:none;}
    #minimap{display:none;position:fixed;bottom:140px;right:12px;border:2px solid #1e1e2e;background:rgba(0,0,0,0.8);image-rendering:pixelated;z-index:10;}
    @media(max-width:600px){#minimap{bottom:170px;right:8px;}}

    /* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
    #hud{display:none;position:fixed;inset:0;pointer-events:none;z-index:10;}
    #hud-bottom{position:absolute;bottom:0;left:0;right:0;height:clamp(60px,10vw,72px);background:linear-gradient(180deg,transparent 0%,rgba(0,0,0,0.9) 40%);display:flex;align-items:center;justify-content:center;gap:clamp(16px,4vw,40px);padding:0 16px;}
    .hud-block{text-align:center;}
    .hud-label{font-size:clamp(5px,1.2vw,6px);color:#444;margin-bottom:3px;letter-spacing:1px;}
    #health-wrap{width:clamp(120px,25vw,200px);height:14px;background:#0a0a0a;border:1px solid #1a1a1a;position:relative;overflow:hidden;}
    #health-bar{height:100%;transition:width .15s,background .3s;}
    #health-bar::after{content:'';position:absolute;top:0;left:0;right:0;height:40%;background:rgba(255,255,255,0.15);}
    #health-val{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:7px;color:#fff;text-shadow:0 1px 3px #000;}
    #ammo-val{font-size:clamp(14px,4vw,20px);color:var(--yellow);line-height:1;}
    #ammo-max{font-size:clamp(7px,1.5vw,9px);color:#555;}
    #char-name-hud{font-size:clamp(7px,1.8vw,9px);}
    #weapon-name-hud{font-size:clamp(5px,1.2vw,6px);color:#666;margin-top:3px;}
    #kill-counter{position:absolute;top:12px;left:12px;background:rgba(0,0,0,0.85);border:1px solid #1e1e2e;border-left:3px solid var(--orange);padding:8px 14px;}
    #kill-counter .kc-num{font-size:clamp(18px,5vw,28px);color:var(--orange);line-height:1;}
    #kill-counter .kc-label{font-size:5px;color:#555;margin-top:3px;}
    #kill-counter .kc-goal{font-size:5px;color:#333;margin-top:2px;}
    #scoreboard{position:absolute;top:12px;right:12px;background:rgba(0,0,0,0.85);border:1px solid #1e1e2e;border-right:3px solid var(--cyan);padding:10px 14px;min-width:clamp(140px,30vw,210px);}
    #scoreboard h3{font-size:clamp(5px,1.5vw,7px);color:var(--cyan);margin-bottom:8px;}
    .sb-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;gap:6px;}
    .sb-dot{width:5px;height:5px;flex-shrink:0;}
    .sb-name{font-size:clamp(5px,1.2vw,6px);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .sb-kills{font-size:clamp(8px,2vw,10px);color:var(--orange);}
    #kill-feed{position:absolute;top:12px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:4px;}
    .kf-entry{background:rgba(0,0,0,0.88);border:1px solid #222;border-left:3px solid;padding:5px 12px;font-size:clamp(5px,1.5vw,7px);white-space:nowrap;animation:kfSlide 3s forwards;}
    @keyframes kfSlide{0%{opacity:0;transform:translateY(-8px)}10%{opacity:1;transform:translateY(0)}70%{opacity:1}100%{opacity:0}}
    #reload-bar-wrap{position:absolute;bottom:clamp(68px,12vw,88px);left:50%;transform:translateX(-50%);display:none;flex-direction:column;align-items:center;gap:4px;}
    #reload-bar-wrap .rl-label{font-size:7px;color:var(--orange);}
    #reload-bar-outer{width:140px;height:6px;background:#111;border:1px solid #222;}
    #reload-bar-inner{height:100%;width:0%;background:var(--orange);}
    #death-screen{display:none;position:fixed;inset:0;background:rgba(200,0,0,0.12);z-index:20;align-items:center;justify-content:center;flex-direction:column;gap:12px;}
    #death-screen.visible{display:flex;}
    #death-screen h2{font-size:clamp(14px,4vw,20px);color:#ff1744;text-shadow:0 0 20px #ff1744;}
    #death-screen p{font-size:7px;color:#888;}
    #respawn-countdown{font-size:clamp(20px,6vw,28px);color:#ff6b35;}
    #game-over-screen{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:50;align-items:center;justify-content:center;flex-direction:column;gap:20px;}
    #game-over-screen.visible{display:flex;}
    #game-over-screen h2{font-size:clamp(18px,5vw,30px);text-shadow:0 0 30px currentColor;}
    #game-over-screen p{font-size:9px;color:#666;}
    #btn-new-game{background:var(--cyan);color:#000;border:none;font-family:'Press Start 2P',monospace;font-size:11px;padding:14px 32px;cursor:pointer;pointer-events:all;touch-action:manipulation;}
    #damage-flash{position:fixed;inset:0;background:rgba(255,0,0,0);pointer-events:none;z-index:30;transition:background .05s;}

    /* ‚ïê‚ïê MOBILE TOUCH CONTROLS ‚ïê‚ïê */
    #mobile-controls{display:none;position:fixed;inset:0;pointer-events:none;z-index:15;}

    /* Left joystick zone */
    #joystick-zone{position:absolute;bottom:80px;left:20px;width:160px;height:160px;pointer-events:all;touch-action:none;}
    #joystick-base{position:absolute;inset:0;border-radius:50%;background:rgba(255,255,255,0.06);border:2px solid rgba(255,255,255,0.15);}
    #joystick-knob{position:absolute;width:60px;height:60px;border-radius:50%;background:rgba(0,229,255,0.35);border:2px solid rgba(0,229,255,0.7);top:50%;left:50%;transform:translate(-50%,-50%);transition:none;box-shadow:0 0 12px rgba(0,229,255,0.4);}

    /* Right aim/shoot zone */
    #aim-zone{position:absolute;bottom:80px;right:0;width:55%;height:260px;pointer-events:all;touch-action:none;}

    /* Shoot button */
    #btn-shoot{position:absolute;bottom:90px;right:30px;width:80px;height:80px;border-radius:50%;background:rgba(255,107,53,0.3);border:3px solid rgba(255,107,53,0.8);display:flex;align-items:center;justify-content:center;font-size:10px;color:var(--orange);pointer-events:all;touch-action:manipulation;box-shadow:0 0 16px rgba(255,107,53,0.3);font-family:'Press Start 2P',monospace;}
    #btn-shoot:active,#btn-shoot.firing{background:rgba(255,107,53,0.6);box-shadow:0 0 30px rgba(255,107,53,0.7);}

    /* Reload button */
    #btn-reload-mobile{position:absolute;bottom:90px;right:124px;width:56px;height:56px;border-radius:50%;background:rgba(255,235,59,0.15);border:2px solid rgba(255,235,59,0.5);display:flex;align-items:center;justify-content:center;font-size:7px;color:var(--yellow);pointer-events:all;touch-action:manipulation;font-family:'Press Start 2P',monospace;text-align:center;line-height:1.4;}

    /* Aim indicator (shows where you're aiming) */
    #aim-indicator{position:absolute;bottom:160px;right:100px;width:20px;height:20px;border-radius:50%;border:2px solid rgba(255,255,255,0.3);pointer-events:none;}

    @media(min-width:769px){
      /* Desktop: hide touch controls, show normal cursor */
      #mobile-controls{display:none!important;}
      #gameCanvas{cursor:none;}
    }
    @media(max-width:768px){
      /* Mobile: show touch controls */
      #mobile-controls{display:block;}
      #gameCanvas{cursor:default;}
      /* Shrink scoreboard on mobile */
      #scoreboard{min-width:120px;max-width:140px;}
      /* Move minimap up away from controls */
      #minimap{bottom:260px;right:8px;}
    }
  </style>
</head>
<body>

<button id="sound-toggle">üîä SFX</button>

<!-- ‚îÄ‚îÄ LOBBY ‚îÄ‚îÄ -->
<div id="lobby">
  <div id="lobby-bg"></div>
  <div id="lobby-content">
    <div class="title-wrap">
      <h1>CE STRIKE</h1>
      <div class="subtitle">‚ö° RETRO ARENA MULTIPLAYER SHOOTER ‚ö°</div>
    </div>
    <input type="text" id="player-name" placeholder="ENTER YOUR CALLSIGN" maxlength="16" autocomplete="off" />
    <div class="char-grid" id="char-grid"></div>
    <button id="btn-play" disabled>‚ñ∫ DEPLOY</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ GAME CANVAS ‚îÄ‚îÄ -->
<canvas id="gameCanvas"></canvas>
<canvas id="minimap" width="160" height="107"></canvas>

<!-- ‚îÄ‚îÄ HUD ‚îÄ‚îÄ -->
<div id="hud">
  <div id="kill-counter">
    <div class="kc-num" id="my-kills">0</div>
    <div class="kc-label">KILLS</div>
    <div class="kc-goal">GOAL: 15</div>
  </div>
  <div id="scoreboard">
    <h3>‚óà BOARD</h3>
    <div id="sb-rows"></div>
  </div>
  <div id="kill-feed"></div>
  <div id="hud-bottom">
    <div class="hud-block">
      <div class="hud-label">HEALTH</div>
      <div id="health-wrap">
        <div id="health-bar" style="width:100%;background:#00e676"></div>
        <div id="health-val">100</div>
      </div>
    </div>
    <div class="hud-block">
      <div class="hud-label">AMMO</div>
      <div id="ammo-val">--</div>
      <div id="ammo-max">/ --</div>
    </div>
    <div class="hud-block">
      <div class="hud-label">AGENT</div>
      <div id="char-name-hud">---</div>
      <div id="weapon-name-hud">---</div>
    </div>
  </div>
  <div id="reload-bar-wrap">
    <div class="rl-label">‚ü≥ RELOADING</div>
    <div id="reload-bar-outer"><div id="reload-bar-inner"></div></div>
  </div>
  <div id="death-screen">
    <h2>YOU DIED</h2>
    <p>RESPAWNING IN</p>
    <div id="respawn-countdown">3</div>
  </div>
</div>

<!-- ‚îÄ‚îÄ MOBILE TOUCH CONTROLS ‚îÄ‚îÄ -->
<div id="mobile-controls">
  <!-- Left: Virtual Joystick -->
  <div id="joystick-zone">
    <div id="joystick-base"></div>
    <div id="joystick-knob"></div>
  </div>
  <!-- Right: Aim zone (drag to aim) + shoot button -->
  <div id="aim-zone"></div>
  <div id="btn-shoot">FIRE</div>
  <div id="btn-reload-mobile">‚ü≥<br>RELOAD</div>
</div>

<div id="damage-flash"></div>

<div id="game-over-screen">
  <h2 id="go-winner-text">WINNER!</h2>
  <p id="go-sub">reached 15 kills</p>
  <button id="btn-new-game">‚ñ∫ NEW GAME</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="client.js"></script>
</body>
</html>
