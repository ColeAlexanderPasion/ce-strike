<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <title>CE Strike</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    :root{--c:#00e5ff;--o:#ff6b35;--y:#ffeb3b;--dk:#08080f;}
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    body{background:var(--dk);color:#e0e0e0;font-family:'Press Start 2P',monospace;overflow:hidden;user-select:none;touch-action:none;}
    body::after{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.07) 2px,rgba(0,0,0,0.07) 4px);pointer-events:none;z-index:9999;}

    /* LOBBY */
    #lobby{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;background:#050508;z-index:100;overflow-y:auto;padding:16px 10px 30px;}
    #lbg{position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.04) 1px,transparent 1px);background-size:40px 40px;animation:bgS 8s linear infinite;pointer-events:none;}
    @keyframes bgS{from{background-position:0 0}to{background-position:40px 40px}}
    #lc{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;width:100%;max-width:680px;}
    h1{font-size:clamp(22px,5.5vw,48px);color:var(--c);text-shadow:0 0 30px var(--c);letter-spacing:clamp(3px,2vw,8px);margin:10px 0 6px;animation:tp 2s ease-in-out infinite;}
    @keyframes tp{0%,100%{text-shadow:0 0 30px var(--c)}50%{text-shadow:0 0 55px var(--c),0 0 80px rgba(0,229,255,0.5)}}
    .sub{font-size:clamp(5px,1.4vw,7px);color:var(--o);letter-spacing:2px;margin-bottom:22px;}
    #pname{background:rgba(0,229,255,0.05);border:2px solid var(--c);color:#fff;font-family:'Press Start 2P',monospace;font-size:clamp(9px,2.2vw,12px);padding:12px 20px;margin-bottom:18px;outline:none;width:min(340px,88vw);text-align:center;}
    #pname:focus{border-color:var(--o);}
    .cgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(95px,1fr));gap:8px;margin-bottom:18px;width:100%;}
    .cc{cursor:pointer;border:2px solid #1e1e2e;padding:10px 6px;text-align:center;background:rgba(255,255,255,0.02);}
    .cc:active{transform:scale(0.95);}
    .cc.sel{border-color:var(--c);background:rgba(0,229,255,0.06);box-shadow:0 0 14px rgba(0,229,255,0.2);}
    .cpv{display:block;margin:0 auto 7px;image-rendering:pixelated;}
    .cn{font-size:clamp(5px,1.3vw,7px);color:#fff;margin-bottom:4px;}
    .cw{font-size:clamp(4px,1vw,5px);color:#888;margin-bottom:7px;}
    .sr{display:flex;align-items:center;gap:4px;margin-bottom:3px;}
    .sl{font-size:4px;color:#666;width:18px;text-align:right;}
    .sb{flex:1;height:4px;background:#111;overflow:hidden;}
    .sf{height:100%;}
    #bplay{background:var(--c);color:#000;border:none;font-family:'Press Start 2P',monospace;font-size:clamp(10px,2.5vw,13px);padding:14px 40px;cursor:pointer;letter-spacing:2px;touch-action:manipulation;}
    #bplay:active{background:var(--o);}
    #bplay:disabled{background:#1a1a2e;color:#333;cursor:not-allowed;}

    /* SOUND */
    #stog{position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.75);border:2px solid #333;color:#aaa;font-family:'Press Start 2P',monospace;font-size:7px;padding:7px 10px;cursor:pointer;z-index:200;touch-action:manipulation;}

    /* GAME */
    #gc{display:none;position:fixed;top:0;left:0;cursor:none;}
    #mm{display:none;position:fixed;border:2px solid #1e1e2e;background:rgba(0,0,0,0.8);image-rendering:pixelated;z-index:10;}

    /* HUD */
    #hud{display:none;position:fixed;inset:0;pointer-events:none;z-index:10;}
    #hbot{position:absolute;bottom:0;left:0;right:0;height:62px;background:linear-gradient(transparent,rgba(0,0,0,0.92) 50%);display:flex;align-items:center;justify-content:center;gap:clamp(14px,4vw,36px);}
    .hb{text-align:center;}
    .hl{font-size:5px;color:#444;margin-bottom:3px;}
    #hw{width:clamp(110px,22vw,190px);height:13px;background:#0a0a0a;border:1px solid #1a1a1a;position:relative;overflow:hidden;}
    #hbar{height:100%;transition:width .12s,background .3s;}
    #hbar::after{content:'';position:absolute;top:0;left:0;right:0;height:40%;background:rgba(255,255,255,0.15);}
    #hval{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:6px;color:#fff;text-shadow:0 1px 2px #000;}
    #av{font-size:clamp(14px,4vw,20px);color:var(--y);line-height:1;}
    #am{font-size:8px;color:#555;}
    #cnh{font-size:clamp(7px,1.8vw,9px);}
    #wnh{font-size:5px;color:#666;margin-top:2px;}
    #kc{position:absolute;top:10px;left:10px;background:rgba(0,0,0,0.85);border:1px solid #1e1e2e;border-left:3px solid var(--o);padding:8px 12px;}
    #kc .kn{font-size:clamp(16px,5vw,26px);color:var(--o);line-height:1;}
    #kc .kl{font-size:5px;color:#555;margin-top:2px;}
    #kc .kg{font-size:4px;color:#333;margin-top:1px;}
    #sb{position:absolute;top:10px;right:10px;background:rgba(0,0,0,0.85);border:1px solid #1e1e2e;border-right:3px solid var(--c);padding:10px 12px;min-width:clamp(120px,28vw,200px);}
    #sb h3{font-size:clamp(5px,1.5vw,7px);color:var(--c);margin-bottom:8px;}
    .sr2{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;gap:5px;}
    .sd{width:5px;height:5px;flex-shrink:0;}
    .sn{font-size:clamp(4px,1.2vw,6px);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .sk{font-size:clamp(8px,2vw,10px);color:var(--o);}
    #kf{position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:4px;}
    .ke{background:rgba(0,0,0,0.88);border:1px solid #222;border-left:3px solid;padding:5px 12px;font-size:clamp(5px,1.5vw,7px);white-space:nowrap;animation:ks 3s forwards;}
    @keyframes ks{0%{opacity:0;transform:translateY(-6px)}10%{opacity:1;transform:translateY(0)}70%{opacity:1}100%{opacity:0}}
    #rlw{position:absolute;bottom:clamp(66px,12vw,80px);left:50%;transform:translateX(-50%);display:none;flex-direction:column;align-items:center;gap:3px;}
    #rlw .rll{font-size:7px;color:var(--o);}
    #rlo{width:130px;height:5px;background:#111;border:1px solid #222;}
    #rli{height:100%;width:0%;background:var(--o);}
    #ds{display:none;position:fixed;inset:0;background:rgba(200,0,0,0.12);z-index:20;align-items:center;justify-content:center;flex-direction:column;gap:10px;}
    #ds.vis{display:flex;}
    #ds h2{font-size:clamp(14px,4vw,20px);color:#ff1744;text-shadow:0 0 20px #ff1744;}
    #ds p{font-size:7px;color:#888;}
    #rcd{font-size:clamp(20px,6vw,28px);color:var(--o);}
    #gos{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:50;align-items:center;justify-content:center;flex-direction:column;gap:18px;}
    #gos.vis{display:flex;}
    #gos h2{font-size:clamp(16px,5vw,28px);text-shadow:0 0 30px currentColor;}
    #gos p{font-size:8px;color:#666;}
    #bng{background:var(--c);color:#000;border:none;font-family:'Press Start 2P',monospace;font-size:11px;padding:13px 28px;cursor:pointer;pointer-events:all;touch-action:manipulation;}
    #bng:active{background:var(--o);}
    #df{position:fixed;inset:0;background:rgba(255,0,0,0);pointer-events:none;z-index:30;}

    /* ‚ïê‚ïê MOBILE DUAL-STICK CONTROLS ‚ïê‚ïê */
    #mctrl{display:none;position:fixed;inset:0;pointer-events:none;z-index:15;}

    /* Left stick ‚Äì MOVE */
    #lzone{position:absolute;bottom:70px;left:16px;width:150px;height:150px;pointer-events:all;touch-action:none;}
    #lbase{position:absolute;inset:0;border-radius:50%;background:rgba(255,255,255,0.05);border:2px solid rgba(255,255,255,0.12);}
    #lknob{position:absolute;width:56px;height:56px;border-radius:50%;background:rgba(0,229,255,0.3);border:2px solid rgba(0,229,255,0.65);top:50%;left:50%;transform:translate(-50%,-50%);box-shadow:0 0 10px rgba(0,229,255,0.35);}
    #llbl{position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:6px;color:rgba(255,255,255,0.3);white-space:nowrap;}

    /* Right stick ‚Äì AIM */
    #rzone{position:absolute;bottom:70px;right:16px;width:150px;height:150px;pointer-events:all;touch-action:none;}
    #rbase{position:absolute;inset:0;border-radius:50%;background:rgba(255,107,53,0.05);border:2px solid rgba(255,107,53,0.2);}
    #rknob{position:absolute;width:56px;height:56px;border-radius:50%;background:rgba(255,107,53,0.3);border:2px solid rgba(255,107,53,0.7);top:50%;left:50%;transform:translate(-50%,-50%);box-shadow:0 0 10px rgba(255,107,53,0.35);}
    #rlbl{position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);font-size:6px;color:rgba(255,255,255,0.3);white-space:nowrap;}

    /* Shoot & Reload buttons */
    #bfire{position:absolute;bottom:230px;right:30px;width:70px;height:70px;border-radius:50%;background:rgba(255,30,70,0.25);border:3px solid rgba(255,30,70,0.7);display:flex;align-items:center;justify-content:center;font-size:7px;color:#ff1744;pointer-events:all;touch-action:manipulation;box-shadow:0 0 14px rgba(255,30,70,0.3);font-family:'Press Start 2P',monospace;line-height:1.4;text-align:center;}
    #bfire.act{background:rgba(255,30,70,0.55);box-shadow:0 0 28px rgba(255,30,70,0.65);}
    #brl{position:absolute;bottom:230px;left:180px;width:52px;height:52px;border-radius:50%;background:rgba(255,235,59,0.12);border:2px solid rgba(255,235,59,0.4);display:flex;align-items:center;justify-content:center;font-size:6px;color:var(--y);pointer-events:all;touch-action:manipulation;font-family:'Press Start 2P',monospace;text-align:center;line-height:1.4;}

    /* Minimap position for mobile */
    @media(max-width:768px){
      #mm{bottom:260px;right:10px;}
      #sb{min-width:110px;max-width:130px;}
    }
    @media(min-width:769px){
      #mctrl{display:none!important;}
      #gc{cursor:none;}
      #mm{bottom:80px;right:14px;}
    }
  </style>
</head>
<body>

<button id="stog">üîä SFX</button>

<!-- LOBBY -->
<div id="lobby">
  <div id="lbg"></div>
  <div id="lc">
    <h1>CE STRIKE</h1>
    <div class="sub">‚ö° RETRO ARENA MULTIPLAYER SHOOTER ‚ö°</div>
    <input type="text" id="pname" placeholder="ENTER YOUR CALLSIGN" maxlength="16" autocomplete="off"/>
    <div class="cgrid" id="cgrid"></div>
    <button id="bplay" disabled>‚ñ∫ DEPLOY</button>
  </div>
</div>

<canvas id="gc"></canvas>
<canvas id="mm" width="160" height="107"></canvas>

<!-- HUD -->
<div id="hud">
  <div id="kc"><div class="kn" id="myk">0</div><div class="kl">KILLS</div><div class="kg">GOAL: 15</div></div>
  <div id="sb"><h3>‚óà BOARD</h3><div id="sbr"></div></div>
  <div id="kf"></div>
  <div id="hbot">
    <div class="hb"><div class="hl">HEALTH</div><div id="hw"><div id="hbar" style="width:100%;background:#00e676"></div><div id="hval">100</div></div></div>
    <div class="hb"><div class="hl">AMMO</div><div id="av">--</div><div id="am">/ --</div></div>
    <div class="hb"><div class="hl">AGENT</div><div id="cnh">---</div><div id="wnh">---</div></div>
  </div>
  <div id="rlw"><div class="rll">‚ü≥ RELOADING</div><div id="rlo"><div id="rli"></div></div></div>
  <div id="ds"><h2>YOU DIED</h2><p>RESPAWNING IN</p><div id="rcd">3</div></div>
</div>

<!-- MOBILE DUAL-STICK -->
<div id="mctrl">
  <div id="lzone"><div id="lbase"></div><div id="lknob"></div><div id="llbl">MOVE</div></div>
  <div id="rzone"><div id="rbase"></div><div id="rknob"></div><div id="rlbl">AIM</div></div>
  <div id="bfire">FIRE</div>
  <div id="brl">‚ü≥<br>RELOAD</div>
</div>

<div id="df"></div>

<div id="gos">
  <h2 id="gow">WINNER!</h2>
  <p id="gos2">reached 15 kills</p>
  <button id="bng">‚ñ∫ NEW GAME</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script src="client.js"></script>
</body>
</html>
